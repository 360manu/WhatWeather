(function(a){a.fn.extend({whatWeather:function(b){var d=a(this);function c(m){var f=new Date().getTime();var h=window.location.protocol+"//"+window.location.host;var g=window.location.pathname!="/"?window.location.pathname.split("/"):[],k="";for(var o=1;o<g.length-1;o++){k+="/"+g[o]}h=h+k;var t={uuid:f,key:"",uri:h,id:"",city:"",days:1,latitude:0,longitude:0,ip:false,geolocation:false,async:true,refresh:600,dayAndNight:false,cssClass:"widget-1",typeTemp:"C",day:"Date",max:"Max",min:"Min",msgError:"Loading error",weekDays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],dateFormat:"{{dd}}/{{mm}}/{{yy}}",updateDateFormat:"{{DD}} {{M}} {{d}}, {{yy}}",template:0,templates:['<div class="{{cssClass}}"><div class="current"><p><span class="temperature">{{currentCondition.temp}}°<sup>{{typeTemp}}</sup></span><span class="climacon {{currentWeatherIcon}} pic"></span><span class="location">{{city}}, {{country}}</span></p></div><div class="next-days" style="display:none"><p><span class="day">{{day}}</span><span class="temp-max">{{max}}</span><span class="temp-min">{{min}}</span><span class="temp-pic"></span></p>{{#nextDays}}<p><span class="day">{{date}}</span><span class="temp-max">{{tempMax}}°</span><span class="temp-min">{{tempMin}}°</span><span class="climacon {{dayWeatherIcon}} temp-pic"></span></p>{{/nextDays}}</div></div>','<div class="{{cssClass}}"><div class="current"><p><span class="temperature">{{currentCondition.temp}}°<sup>{{typeTemp}}</sup></span><span class="climacon {{currentWeatherIcon}} pic"></span><span class="location">{{city}}, {{country}}</span></p></div></div>','<div class="{{cssClass}}"><div class="current"><p><span class="climacon {{currentWeatherIcon}} pic"></span></p><p><span class="temperature">{{currentCondition.temp}}°<sup>{{typeTemp}}</sup></span><span class="location">{{city}}</span></p></div></div>'],icons:{day:{"w-395":"flurries sun","w-392":"lightning sun","w-389":"lightning","w-386":"lightning sun","w-377":"hail","w-374":"hail sun","w-371":"fleurries sun","w-368":"snow sun","w-365":"sleet sun","w-362":"sleet sun","w-359":"downpour","w-356":"downpour sun","w-353":"showers sun","w-350":"hail","w-338":"fleurries","w-335":"fleurries sun","w-332":"fleurries","w-329":"fleurries","w-326":"snow sun","w-323":"snow sun","w-320":"snow","w-317":"hail","w-314":"hail","w-311":"hail","w-308":"rain","w-305":"rain sun","w-302":"rain","w-299":"rain sun","w-296":"drizzle sun","w-293":"drizzle","w-284":"hail","w-281":"hail","w-266":"drizzle","w-263":"drizzle sun","w-260":"flog sun","w-248":"flog sun","w-230":"snowflake","w-227":"snow","w-200":"lightning sun","w-185":"hail","w-182":"hail","w-179":"sleet sun","w-176":"drizzle sun","w-143":"haze sun","w-122":"cloud","w-119":"cloud","w-116":"cloud sun","w-113":"sun"},night:{"w-395":"fleurries moon","w-392":"lightning moon","w-389":"lightning","w-386":"lightning moon","w-377":"hail","w-374":"hail moon","w-371":"fleurries moon","w-368":"snow moon","w-365":"sleet moon","w-362":"sleet moon","w-359":"downpour","w-356":"downpour moon","w-353":"showers moon","w-350":"hail","w-338":"fleurries","w-335":"fleurries moon","w-332":"fleurries","w-329":"fleurries","w-326":"snow moon","w-323":"snow moon","w-320":"snow","w-317":"hail","w-314":"hail","w-311":"hail","w-308":"rain","w-305":"rain moon","w-302":"rain","w-299":"rain moon","w-296":"drizzle moon","w-293":"drizzle","w-284":"hail","w-281":"hail","w-266":"drizzle","w-263":"drizzle moon","w-260":"flog moon","w-248":"flog moon","w-230":"snowflake","w-227":"snow","w-200":"lightning moon","w-185":"hail","w-182":"hail","w-179":"sleet moon","w-176":"drizzle moon","w-143":"haze moon","w-122":"cloud","w-119":"cloud","w-116":"cloud moon","w-113":"moon"}},before:function(u,i){u.html('<div class="loading"></div>')},after:function(u,i){if(a(".next-days",u).length){a(".next-days",u).delay(500).toggle("fast")}},success:function(x,y,u){y.data.current_condition[0].temp=u.typeTemp.toLowerCase()=="c"?y.data.current_condition[0].temp_C:y.data.current_condition[0].temp_F;y.data.current_condition[0].dayOrNight="day";if(u.dayAndNight){y.data.current_condition[0].dayOrNight=p(y.data.current_condition[0].localObsDateTime)?"day":"night"}y.data.current_condition[0].localObsDateTime=Mustache.render(u.updateDateFormat,e(y.data.current_condition[0].localObsDateTime));var w=u.icons.day;for(var v=0;v<y.data.weather.length;v++){y.data.weather[v].dayWeatherIcon=w["w-"+y.data.weather[v].weatherCode];y.data.weather[v].dayWeatherPic=y.data.weather[v].weatherCode;y.data.weather[v].date=Mustache.render(u.dateFormat,j(y.data.weather[v].date));y.data.weather[v].tempMin=u.typeTemp.toLowerCase()=="c"?y.data.weather[v].tempMinC:y.data.weather[v].tempMinF;y.data.weather[v].tempMax=u.typeTemp.toLowerCase()=="c"?y.data.weather[v].tempMaxC:y.data.weather[v].tempMaxF}var z={day:u.day,max:u.max,min:u.min,cssClass:u.cssClass,typeTemp:u.typeTemp,currentCondition:y.data.current_condition[0],currentWeatherIcon:y.data.current_condition[0].dayOrNight=="night"?u.icons.night["w-"+y.data.current_condition[0].weatherCode]:u.icons.day["w-"+y.data.current_condition[0].weatherCode],city:y.data.nearest_area[0].areaName[0].value,country:y.data.nearest_area[0].country[0].value,nextDays:(u.days>0?y.data.weather:null),options:u};if(window.localStorage&&u.refresh>0){localStorage.setItem(u.id?u.id:u.city,JSON.stringify(z));localStorage.setItem((u.id?u.id:u.city)+"-time",new Date().getTime()+(u.refresh*1000))}r(x,z)},fail:function(u,i){u.html('<div class="error"><span>'+i.msgError+"</span></div>")}};var n=function(){var u=a(Mustache.render(t.templates[t.template],t));var i=window.localStorage&&t.refresh>0?(new Date().getTime()>window.localStorage.getItem((t.id?t.id:t.city)+"-time")?true:false):true;d.append(u);if(i){t.before(u);if(t.ip){a.ajaxSetup({async:false});a.getJSON("http://jsonip.com/",function(v){t.city=v.ip});a.ajaxSetup({async:true})}else{if(t.latitude!=0&&t.longitude!=0){t.city=t.latitude+","+t.longitude}}a.ajaxSetup({async:t.async});a.getJSON("http://free.worldweatheronline.com/feed/weather.ashx?callback=?",{q:t.city.replace(" ","+"),num_of_days:t.days,key:t.key,includeLocation:"yes",extra:"localObsTime",format:"json"}).done(function(v){if(v.data.error){t.msgError=v.data.error[0].msg;t.fail(u,t)}else{t.success(u,v,t)}}).fail(function(v){v.fail(u,v)})}else{r(u,JSON.parse(window.localStorage.getItem(t.id?t.id:t.city)))}};var r=function(i,u){tmp=a(Mustache.render(t.templates[t.template],u));i.replaceWith(tmp);t.after(tmp,t)};var l=function(i){t.latitude=i.coords.latitude;t.longitude=i.coords.longitude;n()};var q=function(i){var u="Error during the geolocation : ";switch(i.code){case i.TIMEOUT:u+="Timeout !";break;case i.PERMISSION_DENIED:u+="You have not given permission";break;case i.POSITION_UNAVAILABLE:u+="The position could not be determined";break;case i.UNKNOWN_ERROR:u+="Unknown error";break}t.ip=true;n()};var j=function(u){var w=new Date(u);if(u){tmp=u.split(/[^0-9]/);for(var v=0;v<5;v++){tmp[v]=tmp[v]!=undefined?tmp[v]:"00"}w=new Date(tmp[0],tmp[1]-1,tmp[2],tmp[3],tmp[4])}parse={a:""+(w.getHours()>12?"pm":"am"),A:""+(w.getHours()>12?"PM":"AM"),g:""+(w.getHours()>12?w.getHours()-12:w.getHours()),gg:""+(w.getHours()<10?"0"+w.getHours():(w.getHours()>12?w.getHours()-12:w.getHours())),h:""+(w.getHours()),hh:""+(w.getHours()<10?"0"+w.getHours():w.getHours()),i:""+(w.getMinutes()),ii:""+(w.getMinutes()<10?"0"+w.getMinutes():w.getMinutes()),s:""+(w.getSeconds()),ss:""+(w.getSeconds()<10?"0"+w.getSeconds():w.getSeconds()),d:""+(w.getDate()),dd:""+(w.getDate()<10?"0"+w.getDate():w.getDate()),m:""+(w.getMonth()+1),mm:""+(w.getMonth()<9?"0"+(w.getMonth()+1):w.getMonth()+1),y:""+(w.getYear()-100),yy:""+(w.getFullYear()),DD:t.weekDays[w.getDay()],D:t.weekDays[w.getDay()].substring(0,3),MM:t.months[w.getMonth()],M:t.months[w.getMonth()].substring(0,3)};return parse};var e=function(i){var u=i.split(" ");var v=u[1].split(":");if(u[2]=="PM"){v[0]=v[0]==12?v[0]:parseInt(v[0])+12}return j(u[0]+"T"+v.join(":"))};var p=function(u){var i=u.split(" ");var u=i[1].split(":");if((i[2].indexOf("AM")!=-1&&parseInt(u[0])>5)||(i[2].indexOf("PM")!=-1&&parseInt(u[0])<8)){return true}else{return false}};var s=function(i){a.extend(t,i);return this};s(m||{});if(navigator.geolocation&&t.geolocation){navigator.geolocation.getCurrentPosition(function(i){l(i)},function(i){q(i)})}else{n()}}return this.each(function(){new c(b);return this})}})})(jQuery);